{% extends "base.html" %}

{% block title %}Admin Dashboard - EduTrack{% endblock %}

{% block content %}

<h2 class="mb-4 text-danger fw-bold">ðŸ‘‘ Admin Control Panel</h2>

<!-- ================= STAT CARDS ================= -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Total Users</h5>
                <h2 class="text-primary">{{ users|length }}</h2>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Total Courses</h5>
                <h2 class="text-success">{{ courses|length }}</h2>
            </div>
        </div>
    </div>
</div>

<hr>
<div class="d-flex justify-content-between align-items-center mt-4">
    <h3>Manage Users</h3>

    <a href="{{ url_for('admin.create_teacher') }}"
       class="btn btn-success">
        âž• Create Teacher
    </a>
</div>
<!-- ================= USERS TABLE ================= -->
<h4 class="mt-4">Manage Users</h4>

<table class="table table-striped table-bordered shadow-sm mt-3">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th style="width: 200px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for u in users %}
        <tr>
            <td>{{ u.user_id }}</td>
            <td>{{ u.name }}</td>
            <td>{{ u.email }}</td>
            <td>
                <span class="badge 
                    {% if u.role == 'admin' %} bg-danger
                    {% elif u.role == 'teacher' %} bg-primary
                    {% else %} bg-secondary {% endif %}">
                    {{ u.role }}
                </span>
            </td>
            <td class="d-flex gap-1 flex-wrap">
    
    <!-- âœï¸ Edit (Ù„Ù„Ø¬Ù…ÙŠØ¹) -->
                <a href="{{ url_for('admin.edit_user', user_id=u.user_id) }}"
                    class="btn btn-sm btn-warning">
                    Edit
                </a>

    <!-- ðŸ”‘ Reset Password (Ù„Ù„Ø¬Ù…ÙŠØ¹) -->
                <a href="{{ url_for('admin.reset_user_password', user_id=u.user_id) }}"
                    class="btn btn-sm btn-secondary">
                    Reset Password
                </a>

            {% if u.role != 'admin' %}
        <!-- ðŸ—‘ Delete (Ù…Ù…Ù†ÙˆØ¹ Ø¹Ù„Ù‰ admin) -->
                <a href="{{ url_for('admin.delete_user', user_id=u.user_id) }}"
                    class="btn btn-sm btn-danger"
                    onclick="return confirm('Are you sure you want to delete this user?')">
                    Delete
                </a>
            {% else %}
                <span class="badge bg-dark">Protected</span>
            {% endif %}
        </td>

            
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{{ url_for('admin.export_users') }}" class="btn btn-outline-secondary mb-5">
    Export Users CSV
</a>

<hr>

<!-- ================= COURSES TABLE ================= -->
<h4 class="mt-4">Manage Courses</h4>

<table class="table table-striped table-bordered shadow-sm mt-3">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Code</th>
            <th>Teacher ID</th>
            <th style="width: 120px;">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for c in courses %}
        <tr>
            <td>{{ c.course_id }}</td>
            <td>{{ c.title }}</td>
            <td>{{ c.code }}</td>
            <td>{{ c.teacher_id }}</td>
            <td>
                <a href="{{ url_for('admin.delete_course', course_id=c.course_id) }}"
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('Delete this course?')">
                    Delete
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<a href="{{ url_for('admin.export_courses') }}" class="btn btn-outline-secondary">
    Export Courses CSV
</a>

{% endblock %}